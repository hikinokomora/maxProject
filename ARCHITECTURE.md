# Архитектура MAX Chatbot MVP

## Обзор системы

MAX Chatbot - это универсальная платформа для цифровизации университетских процессов через чат-интерфейс.

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                         Frontend (React)                     │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  ChatBot Component                                    │   │
│  │  - Управление состоянием чата                        │   │
│  │  - Отображение сообщений                             │   │
│  │  - Обработка пользовательского ввода                 │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Services Layer                                       │   │
│  │  - chatService: API коммуникация                     │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ▼
                    HTTP/HTTPS (REST API)
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Backend (Node.js/Express)                 │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Routes Layer                                         │   │
│  │  - /api/chat     - Обработка сообщений              │   │
│  │  - /api/schedule - Расписание                        │   │
│  │  - /api/events   - Мероприятия                       │   │
│  │  - /api/applications - Заявления                     │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Services Layer                                       │   │
│  │  - chatService: NLP и маршрутизация                  │   │
│  │  - scheduleService: Управление расписанием           │   │
│  │  - eventsService: Управление мероприятиями           │   │
│  │  - applicationsService: Обработка заявлений          │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Configuration Layer                                  │   │
│  │  - university.json: Настройки университета           │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ▼
                    (Будущее: База данных)
```

## Основные компоненты

### Frontend (Client)

**Технологии**: React 18, Axios, CSS3

**Структура:**
- `components/` - React компоненты
  - `ChatBot.jsx` - Основной компонент чата
- `services/` - Сервисы для API коммуникации
  - `chatService.js` - Взаимодействие с backend
- `styles/` - CSS стили
  - `ChatBot.css` - Стили для чат-интерфейса

**Ключевые возможности:**
- Отзывчивый UI с современным дизайном
- Анимации и плавные переходы
- Поддержка различных типов сообщений:
  - Текстовые сообщения
  - Быстрые ответы (suggestions)
  - Карточки (события, заявления)
  - Списки команд
- Индикатор набора текста
- Автопрокрутка к новым сообщениям

### Backend (Server)

**Технологии**: Node.js, Express, CORS, Body-parser

**Структура:**
- `routes/` - API маршруты
  - `chat.js` - Обработка чат-сообщений
  - `schedule.js` - API расписания
  - `events.js` - API мероприятий
  - `applications.js` - API заявлений
- `services/` - Бизнес-логика
  - `chatService.js` - NLP и обработка интентов
  - `scheduleService.js` - Управление расписанием
  - `eventsService.js` - Управление мероприятиями
  - `applicationsService.js` - Обработка заявлений
- `config/` - Конфигурация
  - `university.json` - Настройки университета

**API Endpoints:**

```
POST /api/chat
Request: { "message": "текст сообщения" }
Response: { "success": true, "data": { "text": "...", "suggestions": [...] } }

GET /api/chat/info
Response: { "success": true, "data": { "name": "...", "features": {...} } }

GET /api/schedule?group=ИВТ-101&day=Понедельник
Response: { "success": true, "data": [...] }

GET /api/events?category=academic&limit=5
Response: { "success": true, "data": [...] }

POST /api/applications
Request: { "type": "...", "studentName": "...", ... }
Response: { "success": true, "message": "...", "data": {...} }

GET /api/applications/types
Response: { "success": true, "data": [...] }
```

## Обработка интентов

Система использует keyword-based подход для определения намерений пользователя:

1. **Приветствия** - "привет", "здравствуй"
2. **Помощь** - "помощь", "help"
3. **Расписание** - "расписание"
4. **Мероприятия** - "мероприятия", "события"
5. **Заявления** - "заявление", "заявка"
6. **Контакты** - "контакт", "связь", "поддержка"

## Конфигурация университета

Система легко адаптируется под разные университеты через `university.json`:

```json
{
  "universityName": "Название",
  "features": {
    "applications": true,
    "schedule": true,
    "events": true
  },
  "applicationTypes": [...],
  "departments": [...],
  "chatCommands": [...]
}
```

## Масштабируемость

### Текущий MVP
- In-memory хранилище (для демонстрации)
- Простая обработка интентов на основе ключевых слов
- Статическая конфигурация

### Пути развития

1. **База данных**
   - MongoDB для хранения заявлений, расписания, мероприятий
   - Redis для кэширования и сессий

2. **NLP/AI**
   - Интеграция с DialogFlow или Rasa
   - Машинное обучение для улучшения распознавания интентов
   - Поддержка контекста диалога

3. **Аутентификация**
   - JWT токены
   - OAuth 2.0 для интеграции с университетскими системами
   - Роли и права доступа

4. **Интеграция**
   - Webhooks для MAX messenger
   - API для интеграции с существующими системами университета
   - Экспорт данных

5. **Мониторинг**
   - Логирование (Winston, Morgan)
   - Аналитика использования
   - Отслеживание ошибок (Sentry)

## Безопасность

### Текущие меры
- CORS настроен для контроля доступа
- Валидация входных данных
- Обработка ошибок

### Рекомендации для production
- HTTPS обязательно
- Rate limiting для предотвращения DDoS
- Валидация и санитизация всех входов
- Безопасное хранение секретов (переменные окружения)
- Регулярные обновления зависимостей
- SQL injection защита (при использовании SQL БД)
- XSS защита

## Развертывание

### Docker
- Простой запуск через `docker build` и `docker run`
- Изолированная среда выполнения
- Легко масштабируется

### Production рекомендации
- Использовать reverse proxy (nginx)
- Load balancing для высоких нагрузок
- Автоматическое масштабирование (Kubernetes)
- CI/CD pipeline для автоматического развертывания
- Мониторинг и алертинг

## Производительность

### Оптимизации
- React production build с минификацией
- Gzip сжатие для статических файлов
- Кэширование статических ресурсов
- Code splitting (возможно в будущем)

### Метрики
- Время отклика API: < 200ms
- Размер bundle: ~62KB (gzipped)
- Поддержка ~1000 одновременных пользователей (на базовой конфигурации)

## Тестирование

### Рекомендуемая стратегия
1. Unit тесты для сервисов (Jest)
2. Интеграционные тесты для API (Supertest)
3. E2E тесты для UI (Cypress, Playwright)
4. Нагрузочное тестирование (Artillery, k6)

## Лицензия

MIT - свободное использование и модификация
