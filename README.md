# 🎓 MAX University Chatbot

> Современный чат-бот для университета с умным профилем студента, заявлениями и расписанием

[![Docker](https://img.shields.io/badge/Docker-Ready-blue)](https://www.docker.com/)
[![Node.js](https://img.shields.io/badge/Node.js-18-green)](https://nodejs.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue)](https://www.postgresql.org/)

## ✨ Возможности

- 👤 **Умный профиль** — сохраняет ФИО, группу, курс для быстрой работы
- 📝 **Заявления** — подача и отслеживание статуса с красивыми эмодзи
- 📊 **Статистика** — количество заявлений, статусы, история
- 📅 **Расписание** — просмотр занятий для вашей группы
- 🎯 **Мероприятия** — уведомления о важных событиях
- 🕐 **Московское время** — все даты в UTC+3 (МСК)
- 🎨 **Красивый дизайн** — эмодзи, форматирование, удобные кнопки

## 🚀 Быстрый старт

### Требования
- Docker и Docker Compose
- Токен MAX бота ([получить здесь](https://max.expert/))

### Запуск

1. **Клонируйте репозиторий**
   ```bash
   git clone https://github.com/hikinokomora/maxProject.git
   cd maxProject
   ```

2. **Создайте `.env` файл**
   ```env
   BOT_TOKEN=ваш_токен_от_MAX
   JWT_SECRET=ваш_секретный_ключ
   DATABASE_URL=postgresql://postgres:password@db:5432/maxchatbot
   ```

3. **Запустите Docker**
   ```bash
   docker-compose up -d
   ```

4. **Готово!** 🎉
   - Бот автоматически запустится
   - База данных будет создана и заполнена тестовыми данными
   - Откройте MAX и найдите вашего бота

## 📱 Как использовать

### Для студентов:

1. **Запустите бота** — нажмите `/start`
2. **Заполните профиль** — `Мой профиль` → `Заполнить профиль`
3. **Подайте заявление** — `Подать заявление` → выберите тип
4. **Отслеживайте статус** — `Мои заявления`

### Для администраторов:

- Логин: `admin@university.edu`
- Пароль: `admin123`
- API: `http://localhost:5000/api` (только внутри Docker сети)

## 🏗️ Архитектура

```
┌─────────────────┐
│   MAX Bot API   │
└────────┬────────┘
         │
┌────────▼────────┐      ┌──────────────┐
│  Node.js Server │◄────►│  PostgreSQL  │
│    (Express)    │      │   Database   │
└─────────────────┘      └──────────────┘
```

**Технологии:**
- **Backend**: Node.js 18, Express, Prisma ORM
- **База данных**: PostgreSQL 16
- **Бот**: @maxhub/max-bot-api
- **Аутентификация**: JWT + bcrypt
- **Контейнеризация**: Docker, Docker Compose

## 📋 Примеры использования

### Подача заявления
```
Студент: Подать заявление
Бот: 📄 Доступные типы заявлений:

1. Справка об обучении
2. Академический отпуск
3. Перевод на другую программу

Студент: [нажимает кнопку] Справка об обучении
Бот: Заявление «Справка об обучении».
     Кратко опишите, что требуется:
     
Студент: Нужна справка для банка
Бот: ✅ Заявление №5 создано!
```

### Просмотр статистики
```
Студент: Мой профиль
Бот: 👤 Ваш профиль

ФИО: Иванов Иван Иванович
Email: ivan@example.com

🎓 Учебная информация:
Институт: Институт вычислительных технологий
Направление: Информационные системы и технологии
Группа: ИВТ-101
Курс: 1

📊 Статистика заявлений:
Всего: 5
🕐 В обработке: 2
✅ Одобрено: 2
❌ Отклонено: 1
```

## 🔧 Разработка

### Структура проекта
```
maxProject/
├── server/              
│   ├── config/          # Конфигурация университета
│   ├── middleware/      # Express middleware
│   ├── routes/          # API endpoints
│   ├── services/        # Бизнес-логика
│   └── prisma/          # Схема БД и миграции
├── docker-compose.yml   # Docker конфигурация
└── Dockerfile          # Backend образ
```

### Локальная разработка

```bash
# Установка зависимостей
cd server
npm install

# Запуск в dev режиме
npm run dev

# Prisma команды
npx prisma studio          # GUI для БД
npx prisma db push         # Синхронизация схемы
```

## 📚 API Endpoints

### Публичные
- `POST /api/auth/register` — регистрация
- `POST /api/auth/login` — вход

### Защищённые (требуют JWT)
- `GET /api/applications` — список заявлений
- `POST /api/applications` — создать заявление
- `GET /api/schedule?group=ИВТ-101` — расписание
- `GET /api/events` — мероприятия

## 🔐 Безопасность

- ✅ JWT аутентификация для API
- ✅ Bcrypt хеширование паролей
- ✅ RBAC (роли: STUDENT, TEACHER, STAFF, ADMIN)
- ✅ Изолированная Docker сеть (без внешних портов)
- ✅ Валидация входных данных
- ✅ Защита от SQL инъекций (Prisma ORM)

## 🎨 Новое в версии 2.0

- 🆕 **Умный профиль студента** — автозаполнение заявлений
- 🆕 **Статистика заявлений** — красивые счётчики с эмодзи
- 🆕 **Московское время** — все даты в UTC+3
- 🆕 **Эмодзи-статусы** — 🕐 ✅ ❌ для быстрого понимания
- 🆕 **Упрощённая подача** — только описание, остальное из профиля
- 🆕 **Красивое форматирование** — Markdown, структура, иконки

## 🤝 Поддержка

Возникли вопросы? Откройте [Issue](https://github.com/hikinokomora/maxProject/issues) на GitHub!

## 📄 Лицензия

MIT © 2024

---

Сделано с ❤️ для студентов


## Полезные команды

```powershell
# Разработка
npm run dev:server       # backend с hot-reload

# Docker
.\start-docker.ps1       # запуск
.\stop-docker.ps1        # остановка
docker-compose logs -f   # логи

# Взаимодействие с API внутри сети Docker
docker-compose exec backend wget -qO- http://localhost:5000/health
docker run --rm --network maxproject_app-network curlimages/curl:8.11.0 -s http://backend:5000/api/events

# База данных
cd server
npx prisma studio        # GUI для БД
npx prisma db push       # Применить схему
```

## Лицензия

MIT

---

См. также: SECURITY.md — роли и уровни доступа (RBAC)
