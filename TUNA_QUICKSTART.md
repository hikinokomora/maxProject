# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å Tuna SDK

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

1. ‚úÖ **Tuna SDK –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω** –≤ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ MAX user ID
3. ‚úÖ **Backend endpoint** `/api/auth/tuna-login` –¥–ª—è Tuna
4. ‚úÖ **–°–µ—Ä–≤–∏—Å—ã —Å–æ–∑–¥–∞–Ω—ã**:
   - `tunaService.js` - —Ä–∞–±–æ—Ç–∞ —Å Tuna SDK
   - `authService.js` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT + Tuna)
5. ‚úÖ **ChatBot –æ–±–Ω–æ–≤–ª–µ–Ω** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Tuna
6. ‚úÖ **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –≤ `TUNA_INTEGRATION.md`

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞

```powershell
cd client
npm install
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `@maxhub/tuna` –∏ –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω)

–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```powershell
cd server
npm start
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –Ω–∞—Å—Ç—Ä–æ–µ–Ω (—Å–º. `POSTGRES_QUICKSTART.md`).

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç

```powershell
cd client
npm start
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞ `http://localhost:3000`

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000` - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –≤–µ–±-—Å–∞–π—Ç.

---

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –º–∏–Ω–∏-–∞–ø–ø –≤ MAX

### –í–∞—Ä–∏–∞–Ω—Ç 1: –° ngrok (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok: https://ngrok.com/download
# –∏–ª–∏ —á–µ—Ä–µ–∑ scoop:
scoop install ngrok

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok
ngrok http 3000
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ **HTTPS URL** –∏–∑ ngrok (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://abc123.ngrok.io`).

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–µ–ø–ª–æ–π –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –Ω–∞ Vercel, Netlify, –∏–ª–∏ –¥—Ä—É–≥–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –±–æ—Ç–µ

–û–±–Ω–æ–≤–∏—Ç–µ `server/services/maxBotService.js`:

```javascript
buildMainKeyboardWithApp() {
  const appUrl = 'https://abc123.ngrok.io'; // –í–∞—à ngrok URL
  return Keyboard.inlineKeyboard([
    // ...
    [Keyboard.button.link('üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', appUrl)],
    // ...
  ]);
}
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É MiniApp:

```javascript
const keyboard = Keyboard.inlineKeyboard([
  [Keyboard.button.miniApp('–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', appUrl)]
]);
```

---

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í –±—Ä–∞—É–∑–µ—Ä–µ
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
2. `tunaService.isInMiniApp()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ã—á–Ω–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞

### –í MAX messenger
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–∏–Ω–∏-–∞–ø–ø –∏–∑ –±–æ—Ç–∞
2. Tuna –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
3. `tunaService.getUserInfo()` –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ MAX
4. `authService.authenticateWithTuna()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Tuna –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –Ω–∞–π–¥–∏—Ç–µ:

```
[Tuna] SDK initialized successfully
[App] Running in web browser
```

–ò–ª–∏ –≤ MAX:

```
[Tuna] SDK initialized successfully
[App] Running in MAX mini-app, user: { id: 123, firstName: '–ò–≤–∞–Ω', ... }
```

### –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–í MAX messenger:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–∞–ø–ø
2. –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∂–µ—Ç: `[ChatBot] Auto-authenticating MAX user: ...`
3. Backend —Å–æ–∑–¥–∞—Å—Ç/–Ω–∞–π–¥–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

### –¢–µ—Å—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–∞–ø–ø - –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å—Å—è –∫ –≤–∞—à–µ–º—É MAX user ID.

---

## üì± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
client/
‚îú‚îÄ‚îÄ package.json                 # + @maxhub/tuna
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.js                   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Tuna
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatBot.jsx          # –û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è Tuna
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ tunaService.js       # ‚ú® –ù–æ–≤—ã–π - Tuna SDK wrapper
‚îÇ       ‚îú‚îÄ‚îÄ authService.js       # ‚ú® –ù–æ–≤—ã–π - JWT + Tuna auth
‚îÇ       ‚îî‚îÄ‚îÄ chatService.js       # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π

server/
‚îî‚îÄ‚îÄ routes/
    ‚îî‚îÄ‚îÄ auth.js                  # + POST /api/auth/tuna-login
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```javascript
// App.js –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ MAX
const user = await tunaService.getUserInfo();
await authService.authenticateWithTuna(user);
```

### 2. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π UI
```javascript
if (isInMiniApp && userInfo) {
  return <div>üëã –ü—Ä–∏–≤–µ—Ç, {userInfo.fullName}!</div>;
}
```

### 3. –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
```javascript
tunaService.setMainButton('–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ', () => {
  // Handle click
});
```

### 4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```javascript
await tunaService.showAlert('–ó–∞—è–≤–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
await tunaService.close();
```

---

## üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ç–µ–º—É MAX:

```javascript
const theme = tunaService.getThemeParams();
// theme.bg_color, theme.text_color, theme.button_color
```

–û–±–Ω–æ–≤–∏—Ç–µ `client/src/App.css` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ–º—ã.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### CORS –¥–ª—è –º–∏–Ω–∏-–∞–ø–ø

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –¥–æ–º–µ–Ω–∞ –º–∏–Ω–∏-–∞–ø–ø–∞:

```javascript
// server/index.js
app.use(cors({
  origin: ['http://localhost:3000', 'https://abc123.ngrok.io'],
  credentials: true
}));
```

### HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

MAX —Ç—Ä–µ–±—É–µ—Ç HTTPS –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- ngrok (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–∞–µ—Ç HTTPS)
- Vercel/Netlify (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π HTTPS)
- Let's Encrypt (–¥–ª—è —Å–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **TUNA_INTEGRATION.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Tuna SDK
- **API_EXAMPLES.md** - –ø—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤
- **MIGRATION_GUIDE.md** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ PostgreSQL –∏ JWT

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `cd client && npm install`
- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `cd server && npm start`
- [ ] –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—É—â–µ–Ω: `cd client && npm start`
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3000`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ngrok –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è MAX: `ngrok http 3000`
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) URL –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–æ—Ç–µ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è MAX messenger —Å:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Tuna
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- ‚úÖ PostgreSQL –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–æ–π –∑–∞—è–≤–ª–µ–Ω–∏–π –∫ —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü–∏–µ–π –ø–æ–¥ —Ç–µ–º—É –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
- ‚úÖ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º —Å –±–æ—Ç–æ–º

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm install` –≤ –∫–ª–∏–µ–Ω—Ç–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ! üöÄ
